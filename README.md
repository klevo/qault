# qault

Personal, presumably post quantum safe, key-chain / password manager / secrets vault written in Go, using cryptography primitives from the standard library.

This project is not intended for production use and is published for research purposes only.

Command line interface inspired by [pass](https://www.passwordstore.org/).

## Motivation

I want a simple replacement for the cloud based, big corp tools, like Google or Apple password managers. I'd like to be able to recover access to all my digital services, even in case I loose all my devices, by just remembering a master password and having access to a remote Git repository. 

While at it, lets make the storage/encryption post-quantum safe, assuming the PQ cryptography in Go standard library is indeed quantum safe, which can't really be verified until quantum computers are generally available.

## Goals

* Command line interface following simple UNIX philosophy.
* Unlock using a master password.
* Future proofed by utilizing post-quantum cryptography from Go's standard library.
* Optional agent mode to keep the vault unlocked for a few minutes.

## Design

* Secrets, together with their metadata, are stored as encrypted JSON files in the data directory. The filename is a UUID v7 generated by `github.com/google/uuid` package.
* The secret file JSON structure is as follows: `{ name:, secret:, created_at:, updated_at: }`.
* Data directory lives under `$XDG_DATA_HOME/qault` if present on the system, otherwise `$HOME/.qault`.
* For password based key derivation use [Argon2id](https://pkg.go.dev/golang.org/x/crypto/argon2#hdr-Argon2id) with a reasonably high memory cost and time cost, and a parallelism parameter tuned to the userâ€™s CPU. This is the best we can currently do to protect against brute force offline attacks, as long as the master password has sufficient length and entropy.

## Command Line Interface (CLI)

### Vault initialization

```sh
qault init
```

1. If the data directory doesn't exist, create it.
2. If a `.lock` file under the data directory doesn't exists, asks to enter master password and to confirm it. If empty string is entered, asks again. Once password is confirmed, generates root encryption key salt, encrypts it with the master password and saves it under data directory as `.lock`.

Outputs the location of the data directory to stdout.

### Adding secrets to the vault

```sh
qault add [NAME]
```

Name is a required parameter.

1. Asks for master password and confirms it by decrypting `.lock` from data directory. If decryption fails, exit with 1 and informs that master key is wrong.
2. Asks for the secret to store using secure input under the given name. If input is empty, asks again. 
3. Generates UUID v7, creates the secret JSON payload, encrypts it with master password and saves it under data directory.
4. Inform the user secret was saved under `[NAME]`.

### Listing secrets

```sh
qualt
```

1. Asks for master password and confirms it by decrypting `.lock` from data directory. If decryption fails, exit with 1 and informs that master key is wrong.
2. Loads and decrypts all UUID v7 named files under data directory and outputs only the `name:` value on each new line. If decryption of any of the files fails, inform about it to stderr and exit with code 1.

### Fetching a secret

```sh
qualt [NAME] 
```

1. Asks for master password and confirms it by decrypting `.lock` from data directory. If decryption fails, exit with 1 and informs that master key is wrong.
2. Loads and starts decrypting all UUID v7 named files under data directory. Stops when it finds a case-insensitive match based on the name. Outputs the value of `secret:` to stdout and exits.
3. If the name is not found, exit with code 1 and inform about it to stderr.

### Unlocking the vault for 5 minutes (agent mode)

```sh
qualt unlock
```

Upon entering and validating master key, spawns an agent, that caches the derived encryption key, listing on a socket in the data dir. The agent self-terminates after 5 minutes. Or you can terminate it and thus lock your vault with:

```sh
qualt lock
```

## Development

### Running the CLI

```sh
go run ./cmd/qault
```

### Running tests

```sh
go test ./...
```
